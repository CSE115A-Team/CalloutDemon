<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalloutDemon</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>CalloutDemon</h1>
    <div class="inline-container">
        <select id="mapSelector" onchange="updateMapImage()">
            <option value="ascent">Ascent</option>
            <option value="bind">Bind</option>
            <option value="icebox">Icebox</option>
            <option value="split">Split</option>
            <option value="lotus">Lotus</option>
            <option value="breeze">Breeze</option>
            <option value="sunset">Sunset</option>
        </select>
        <button id="gameButton" onclick="toggleGameLoop()">Start Game</button>
        <a href='settingPage.html'>
            <button id="settingButton">Setting</button>
        </a>
    </div>
    <div id="svgContainerWrapper">
        <svg id="svgContainer" width="600" height="600">
            <image id="mapImage" xlink:href="images/maps/ascent_unlabeled.png" alt="Map Image" style="max-width: 600px; display: block; margin: auto;"/>
        </svg>
    </div>
    <p id="calloutDisplay"></p>
    <div class="inline-container">
        <button id="addButton" onclick="setAddFlag()">Add Callout</button>
        <button id="delButton" onclick="setRemoveFlag()">Delete Callout</button>
    </div>
    <script src="eel.js"></script>
    <script src="main.js"></script>
<div>
    <button id="signInButton">Create Account / Sign In</button>
    <button id="signOutButton">Sign Out</button>

    <div id="message">
        <p>You have signed in as <span id="userName"></span> with the email <span id="userEmail"></span> </p>
    </div>
<script type ="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { CalloutDemon, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";

    const firebaseConfig = {
    apiKey: "AIzaSyDvxstB29Ow7SbYTJbp7uVjIJC052I7ghA",
    authDomain: "calloutdemon.firebaseapp.com",
    projectId: "calloutdemon",
    storageBucket: "calloutdemon.appspot.com",
    messagingSenderId: "150863965910",
    appId: "1:150863965910:web:7db0cc9aa1644c340fa377",
    measurementId: "G-PKX396G4BV"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const provider = new GoogleAuthProvider()

    const signInButton = document.getElementById("signInButton");
    const signOutButton = document.getElementById("signOutButton");
    const message = document.getElementById("message");
    const userName = document.getElementById("userName");
    const userEmail = document.getElementById("userEmail");

    signOutButton.style.display = "none";
    message.style.display = "none";

    const userSignIn = async() => {
    signInWithPopup(auth, provider)
    .then((result) => {
        const user = result.user
        console.log(user);
    }).catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message
    })
}

    const userSignOut = async() => {
    signOut(auth).then(() => {
        alert("You have signed out successfully!");
    }).catch((error) => {})
}

    onAuthStateChanged(auth, (user) => {
    if(user) {
        signOutButton.style.display = "block";
        message.style.display = "block";
        userName.innerHTML = user.displayName;
        userEmail.innerHTML = user.email
    } else {
        signOutButton.style.display = "none";
        message.style.display = "none";
    }
})

    signInButton.addEventListener('click', userSignIn);
    signOutButton.addEventListener('click', userSignOut);
</script>
</body>
</html>